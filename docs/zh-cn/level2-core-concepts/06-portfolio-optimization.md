# 第六章：投资组合优化

## 学习目标

完成本章节学习后，你将能够理解现代投资组合理论的基本原理，掌握均值-方差优化和风险平价策略的计算方法，了解 Black-Litterman 模型的优势和局限，以及学会如何解读和应用投资组合优化结果。预计学习时间为 1.5-2 小时。

## 6.1 投资组合优化概述

### 什么是投资组合优化

投资组合优化是选择最佳资产配置以达到特定目标的过程。在金融领域，最经典的目标是在给定风险水平下最大化预期收益，或在给定收益目标下最小化风险。这个问题由诺贝尔经济学奖得主哈里·马科维茨在 1952 年提出，被称为现代投资组合理论（MPT）的基石。

在 AI Hedge Fund 系统中，投资组合优化由专门的模块负责。它整合来自多个智能体的交易信号，结合风险评估结果，生成最优的资产配置建议。

### 投资组合优化的目标

投资组合优化通常追求以下几个目标：

**风险最小化**：在给定收益约束下，最小化投资组合的波动率或下行风险。

**收益最大化**：在给定风险约束下，最大化投资组合的预期收益。

**风险调整后收益最大化**：优化夏普比率或其他风险调整后收益指标。

**其他目标**：最小化跟踪误差、最大化分散化、满足特定约束（如行业配置、流动性要求）。

## 6.2 均值-方差优化

### 均值-方差理论

均值-方差理论的核心思想是：投资者关心的是整个投资组合的风险和收益，而不是单个资产。通过合理配置不相关的资产，可以在不降低预期收益的情况下降低风险。

**关键假设**：投资者是风险厌恶的，只关心预期收益和风险（用方差衡量）。

**有效前沿**：在收益-风险平面上，所有最优投资组合构成一条曲线，称为「有效前沿」。有效前沿上的每一个点都代表在给定风险水平下能够获得最高收益的投资组合。

### 数学模型

**预期收益向量**：设投资组合包含 n 个资产，E[R] = [E[R₁], E[R₂], ..., E[Rₙ]]ᵀ 表示各资产的预期收益率。

**协方差矩阵**：Σ 表示资产收益率之间的协方差矩阵，其中 Σᵢⱼ = Cov(Rᵢ, Rⱼ)。

**优化问题**：最小化投资组合方差 wᵀΣw，约束条件为 wᵀE[R] = 目标收益，wᵀ1 = 1，其中 w 是资产权重向量。

### 最小方差组合

在所有可能的投资组合中，具有最小方差（风险）的组合称为「最小方差组合」。

**计算方法**：求解无约束优化问题 min wᵀΣw。

**特点**：最小方差组合通常偏向于低波动率的资产，不依赖于预期收益的估计。

### 最大夏普比率组合

在所有投资组合中，具有最高夏普比率的组合是风险调整后收益最优的。

**计算方法**：求解 max (wᵀE[R] - Rf) / √(wᵀΣw)。

**特点**：最大夏普比率组合依赖于无风险收益率的假设。

### 局限与挑战

均值-方差优化虽然理论优美，但存在一些实际挑战：

**对输入敏感**：优化结果对预期收益率和协方差矩阵的估计非常敏感。微小的估计误差可能导致完全不同的最优配置。

**集中化倾向**：优化结果往往产生集中的持仓，因为少数资产可能主导风险贡献。

**不考虑高阶矩**：只考虑一阶矩（收益）和二阶矩（方差），忽略偏度和峰度等高阶矩。

## 6.3 Black-Litterman 模型

### 模型概述

Black-Litterman 模型是对传统均值-方差优化的改进，由 Fischer Black 和 Robert Litterman 在 1992 年提出。该模型解决了传统方法对预期收益输入过于敏感的问题。

**核心思想**：结合市场均衡收益和投资者主观观点，生成更稳健的预期收益估计。

### 市场均衡收益

市场均衡收益是指假设所有投资者都按照市场权重持有资产时的隐含预期收益率。

**公式**：Π = (λΣ)wₘₐᵣₖₑₜ

其中，Π 是均衡超额收益向量，λ 是风险厌恶系数，Σ 是协方差矩阵，wₘₐᵣₖₑₜ 是市场权重向量。

### 融入主观观点

Black-Litterman 模型允许投资者加入自己的观点：

**绝对观点**：A 公司收益率为 10%，B 公司收益率为 8%。

**相对观点**：A 公司比 B 公司收益率高 3%。

**不确定性**：每个观点都有相应的置信度，置信度越高，对结果影响越大。

### 公式推导

**合并公式**：
```
E[R] = [(τΣ)⁻¹ + PᵀΩ⁻¹P]⁻¹[(τΣ)⁻¹Π + PᵀΩ⁻¹Q]
```

其中，τ 是调整参数，P 是观点矩阵，Ω 是观点不确定性矩阵，Q 是观点收益向量。

### 优势与局限

**优势方面**，Black-Litterman 模型产生的预期收益更加稳健，不容易因为输入的微小变化而产生剧烈波动。该模型自然地融合了客观（市场均衡）和主观（投资者观点）信息。

**局限方面**，该模型增加了参数设置复杂性（τ、Ω 等）。模型依赖于协方差矩阵的估计。主观观点的置信度设置具有主观性。

## 6.4 风险平价策略

### 概念介绍

风险平价（Risk Parity）是另一种流行的投资组合构建方法，与传统追求风险调整后收益最大化不同，风险平价追求各资产对组合总风险的贡献相等。

**核心思想**：风险，而非资本，才是真正的「投资成本」。两个各贡献 50% 风险的资产，比各持有 50% 资本的组合更「均衡」。

### 风险贡献计算

单个资产对组合风险的边际贡献：
```
MCRᵢ = ∂σₚ/∂wᵢ = (Σw)ᵢ / σₚ
```

其中，σₚ 是组合波动率，(Σw)ᵢ 是协方差矩阵与权重向量乘积的第 i 个元素。

**风险贡献**：
```
RCᵢ = wᵢ × MCRᵢ = wᵢ(Σw)ᵢ / σₚ
```

### 优化问题

**等风险贡献条件**：RC₁ = RC₂ = ... = RCₙ

**优化问题**：min Σᵢ(RCᵢ - σₚ/n)²，约束条件为 Σwᵢ = 1，wᵢ ≥ 0。

### 风险平价 vs 均值-方差

| 维度 | 均值-方差 | 风险平价 |
|------|-----------|----------|
| 目标 | 风险调整后收益最大化 | 风险贡献均衡 |
| 输入要求 | 预期收益 + 协方差 | 仅需协方差 |
| 对收益预测依赖 | 高 | 低 |
| 配置倾向 | 可能集中 | 天然分散 |
| 直观性 | 较低 | 较高 |

## 6.5 组合优化输出解读

### 优化报告示例

```
Portfolio Optimization Results...
============================

Optimal Allocation:
┌─────────┬──────────────┐
│ Asset   │ Weight (%)   │
├─────────┼──────────────┤
│ AAPL    │ 15.2%        │
│ MSFT    │ 12.8%        │
│ GOOGL   │ 10.5%        │
│ AMZN    │ 8.3%         │
│ NVDA    │ 5.2%         │
│ Cash    │ 48.0%        │
└─────────┴──────────────┘

Expected Metrics:
- Portfolio Return: 12.5% (annualized)
- Portfolio Volatility: 18.2%
- Sharpe Ratio: 0.52
- Max Drawdown (estimated): -22%
```

### 关键指标解释

**配置权重（Weight）**：表示各资产在投资组合中的资金占比。所有权重之和应等于 100%（或接近 100%，取决于是否保留现金）。

**预期收益（Expected Return）**：基于优化模型估计的组合年化预期收益。这是理论值，实际收益可能显著不同。

**波动率（Volatility）**：组合收益的标准差年化值，衡量组合的整体风险水平。

**夏普比率**：风险调整后收益指标，等于 (预期收益 - 无风险收益率) / 波动率。

**最大回撤估计**：基于历史数据和模型假设估计的最大可能回撤。

## 6.6 练习题

### 练习 6.1：简单组合优化

**任务**：计算两个资产的最优配置。

假设两个资产：资产 A 预期收益 10%，波动率 20%；资产 B 预期收益 15%，波动率 25%。相关系数为 0.3。无风险收益率为 5%。

**要求**：分别计算最小方差组合和最大夏普比率组合的权重。

### 练习 6.2：风险贡献计算

**任务**：计算三资产组合的风险贡献。

假设三资产等权重配置，协方差矩阵为：
```
Σ = [[0.04, 0.01, 0.005],
     [0.01, 0.0625, 0.015],
     [0.005, 0.015, 0.09]]
```

**要求**：计算各资产的风险贡献，判断是否满足风险平价条件。

### 练习 6.3：模型比较

**任务**：比较不同优化模型的特点。

**要求**：总结均值-方差、Black-Litterman 和风险平价三种方法的适用场景、优势和局限。

---

## 进阶思考

思考以下问题。投资组合优化模型的假设（如正态分布、线性相关性）与现实市场有多大差距？如何设计一个能够适应不同市场环境的自适应优化系统？机器学习方法如何改进传统组合优化？

下一章节我们将学习回测框架的设计原理和实现方法。

---

## 版本信息

| 项目 | 信息 |
|------|------|
| 文档版本 | 1.0.2 |
| 最后更新 | 2026年2月 |
| 适用版本 | 1.0.0+ |

**更新日志**：
- v1.0.2 (2026.02)：完善 Black-Litterman 模型公式说明
- v1.0.1 (2025.12)：增加风险平价计算示例
- v1.0.0 (2025.10)：初始版本

## 反馈与贡献

如果您在阅读过程中发现问题或有改进建议，欢迎通过 GitHub Issues 提交反馈。
